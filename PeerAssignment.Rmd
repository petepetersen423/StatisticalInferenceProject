---
title: "Statistical Inference - Peer Graded Assignment"
author: "Pete Petersen III"
date: "6/20/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(ggplot2)
##library(tinytex)
library(dplyr)

```


# Part 1: Simulation Exercise

#### Overview:

In this paper we demonstrate that the Central Limit Therom is in congruence with theoretical normal distributions.  In order to accomplish this we will generate a 1000 samples of lenf 40,  We will then take the means of each of these 1000 samples.  This will show that the density of the means is very sumilar to the theoretic density.  The exponential distribution will be simulated in R with rexp(n,lambda) where lambda is the rate parameter.  rexp uses Ahrens, J. H. and Dieter, U. (1972). Computer methods for sampling from the exponential and normal distributions. Communications of the ACM, 15, 873–882.  


#### Simulations: 

The mean of exponential distribution and the standard deviation are both 1/lambda where lambda = 0.2, and distribution of averages of 40 exponentials and will perform 1000 simulations.  

 
#### The Exponential Distribution: 

    Density, distribution function, quantile function and random generation for the exponential distribution with rate (i.e., mean 1/rate).

     Usage
        dexp(x, rate = 1, log = FALSE)
        pexp(q, rate = 1, lower.tail = TRUE, log.p = FALSE)
        qexp(p, rate = 1, lower.tail = TRUE, log.p = FALSE)
        rexp(n, rate = 1)
       
       Arguments:
       
        x, q - 	vector of quantiles.
        p	- vector of probabilities.
        n - number of observations. If length(n) > 1, the length is taken to be the number required.
        rate - vector of rates.
        log, log.p - logical; if TRUE, probabilities p are given as log(p).
        lower.tail - logical; if TRUE (default), probabilities are P[X ≤ x], otherwise, P[X > x].

```{r}
 # Set the initial simulations paremeters wher lamda is the the rate parameter in exponential distrubution.
  lambda <- 0.2

# Set the seed for the random number generator for reproducabkility
  set.seed(11)

  # Set the number of observations. If length(n) > 1, the length is taken to be the number required
  n <- 40

  # Iterate  a thousand times of the exponential distribution where length = 40 and lamda = .2  THis will result in  a 40 row by 1000 column array.
  simulation <- replicate(1000, rexp(n, lambda))
  
# we use the apply to take means over the simulation distribution columns and arrive ar 1 mean per colimn.
  mean_simulation <- apply(simulation, 2, mean)


```

Sample Mean versus Theoretical Mean: Include figures with titles. In the figures, highlight the means you are comparing. Include text that explains the figures and what is shown on them, and provides appropriate numbers.

```{r}

  sampleMean <- mean(mean_simulation)
  simulationmean <- mean(simulation)
  theoretical_mean <- (1/lambda)

```

  The mean of the simulations is `r sampleMean`  
  The theoretical mean  of: \[\mu = \frac{1}{\lambda}=.5\] 
  
  

```{r density, echo=FALSE, fig.width=5,fig.height=5,fig.cap="Fig. 1 Simulation Distribution snd Density"}
# Histogram shows differences
  g<- ggplot(data.frame(mean_simulation),
             aes(x=mean_simulation))
  g<- g + ggtitle("Distribution of Means")
  g<- g + geom_histogram(binwidth = 0.3,color = "black",
                         fill="beige",
                         aes(y = ..density..))
  g<- g + geom_density(colour="red",size=1) +
      labs(x="Means",y="Density")
  print(g)
```

Sample Variance versus Theoretical Variance: Include figures (output from R) with titles. Highlight the variances you are comparing. Include text that explains your understanding of the differences of the variances.



```{r}
# sample deviation & variance
sample_sd <- sd(mean_simulation)
sample_var <- sample_sd^2
simulationmean <- mean(mean_simulation)
# theoretical deviation & variance
theoretical_sd <- (1/lambda)/sqrt(n)
theoretical_var <- ((1/lambda)*(1/sqrt(n)))^2
theoretical_mean <- 1/lambda
```

We now compare data from the simulation to the values the CTL. CTL predicts that the distribution of the simulation should be very close to normal distribution.  

##### Defined As
\[N(\mu, \sigma)\] 

##### where
\[\mu=\frac{1} \lambda\]  

##### and 
\[\sigma =\frac {1 }{\lambda / n^2} \]

```{r,  echo=FALSE}
# Create a table of value foir comparison
table_values<-rbind(c(theoretical_mean,theoretical_sd,theoretical_var),c(simulationmean,sample_sd,sample_var))
colnames(table_values)<-c("Mean","Std","Variance")
rownames(table_values)<-c("Theoretical","Simulation")
```





```{r, echo=FALSE}
kable(table_values, caption = "Simulated vs Theoretical Values",  digits = 3)
```


#### Distribution:  

In the figure below, we plot the histogram of the means and the density of the means in order to note the appearant normalcy.  We also note that the distribution appears centered around.5 and is symetric.  Further,  the similarity of the simulation density in blue to the theoretical density in red highlights the proximity to normalcy of the simulation means which exemplifies the CLT's correctneess.
  
```{r figs, echo=FALSE, fig.width=5,fig.height=5,fig.cap="Fig. 2 Distribution Analysis"}
g <-ggplot(data.frame(mean_simulation),aes(x=mean_simulation))
g <- g + ggtitle("Predicted vs Mean of Simulation Density")
g <- g + geom_histogram(binwidth = 0.3,colour="black",fill="beige",aes(y = ..density..))
g <- g + geom_density(colour="blue",size=1)+labs(x="Mean Values",y="Density")
g <- g + stat_function(fun = dnorm, 
                     args = list(mean = 1/lambda,
                             sd=1/lambda/sqrt(n)),
                     colour="red",size=1,linetype=1)
g <- g +geom_vline(xintercept = theoretical_mean, size=1, colour="red") + 
        geom_vline(xintercept = sampleMean, size=1, colour="blue")  

print(g)
```



```{r figs3, echo=FALSE, fig.width=5,fig.height=5,fig.cap="Fig. 3 Distribution Analysis"}
qqnorm(mean_simulation)
 qqline(mean_simulation, col = "blue")
```

Q-Q Normal Plot also indicates the normal distribution.  qqnorm is a generic function the default method of which produces a normal QQ plot of the values in y. qqline adds a line to a “theoretical”, by default normal, quantile-quantile plot which passes through the probs quantiles, by default the first and third quartiles. The proximity to the xy plot of the simulation pairs demonstrated very litte deviation from normalcy.


## Part 2: Basic Inferential Data Analysis Instructions

Load the ToothGrowth data and perform some basic exploratory data analyses

```{r, echo=FALSE, message=FALSE}
library(datasets)
library(knitr)
library(car)
data("ToothGrowth")
attach(ToothGrowth)
```

```{r}
kable(head(ToothGrowth))
```



```{r ToothPlot1, echo=FALSE, fig.width=5,fig.height=5,fig.cap="Fig. 4 Tooth Length"}

boxplot(ToothGrowth$len ~ ToothGrowth$supp, ylab = 'Tooth Growth in (mm)', xlab = 'Supplement', )

```

The Box Plot above seems to indicate additional tooth growth in the OJ supplement over the VC supplement.

```{r scatter4, message=FALSE ,echo=FALSE, fig.width=7,fig.height=5,fig.cap="Fig. 5 Growth by Supplement and Dose"}

scatterplot(len ~ dose | supp, data=ToothGrowth,
   xlab="Supplment Dose", ylab="Tooth Growth",
   main="Growth by Supplment and Dose")

```

The scatter plot show a higher level of tooth growth at lower dosages as compared to the vitamin C.  However, at the higher dosage (2mg) the supplments seem equally effective. 

## Data Summary

```{r}
str(ToothGrowth)
kable(summary(ToothGrowth))

```

##  Confidence Intervals

```{r}
# Subset the data for confints
ToothGrowth_oj <- subset(ToothGrowth, supp=='OJ')
ToothGrowth_vc <- subset(ToothGrowth, supp=='VC')
ConfIntTable <- rbind(
mean(ToothGrowth$len) + c(-1, 1) * 1.96 * sd(ToothGrowth$len)/sqrt(nrow(ToothGrowth)),
mean(ToothGrowth_oj$len) + c(-1, 1) * 1.96 * sd(ToothGrowth_oj$len)/sqrt(nrow(ToothGrowth_oj)),
mean(ToothGrowth_vc$len) + c(-1, 1) * 1.96 * sd(ToothGrowth_vc$len)/sqrt(nrow(ToothGrowth_vc)))

row.names(ConfIntTable) = c('Overall', 'OJ', 'VC')
df_conf <- as.data.frame.matrix(ConfIntTable) 
df_conf %>% 
  rename(
    'ConfInt-Low' = 'V1',
    'ConfInt-High' = 'V2')


```

## Hypothesis Testing and Sample Analysis
#####  All Data

```{r}
#Run Welch Test on entire Sample
    model1 <- t.test(len ~ supp, data = ToothGrowth)
    model1

# Run power tests to determine power properties of our sample
    all_delta <- power.t.test(n = nrow(ToothGrowth), power = .90, sd = sd(ToothGrowth$len))$delta
    all_size <-  power.t.test( power = .90, delta=3, sd = sd(ToothGrowth$len))$n
    all_power <- power.t.test(n = nrow(ToothGrowth), delta = 3, sd = sd(ToothGrowth$len))$power
```

The p value is somewhat high for all dosages.  Therefore we accept the null H0 hypthesis that there is no difference in the means of the supplements and also accept that there maybe some significance in general on supplement type accross all dosages.  

Power testing indicates that we could only determine a delta of `r round(all_delta,2)` mm with our current sample size with .9 power. If we wanted to increase the length sensitivity to a delta of 3mm we would need a sample size of `r round(all_size,0)`.  At our current sample size of `r nrow(ToothGrowth)`, we can only detect a 3mm growth delta with `r round(all_power,2)` power.  


#####  Analysis at .5mg Doses

```{r}
five <- subset(ToothGrowth, dose == "0.5")
model2 <- t.test(len ~ supp, data = five)
model2

five_delta <- power.t.test(n = nrow(five), power = .90, sd = sd(five$len))$delta
five_size <-  power.t.test(delta = 3, power = .90, sd = sd(five$len))$n
five_power <- power.t.test(delta = 3,n = nrow(five) , sd = sd(five$len))$power
```
The p value is low at the .5 mg dose level.  Therefore we reject the H0 hypthesis that there is no difference in the means of the supplements and we accept that there is some signifcance to the impact on toothgrowth at this dose level.

Power testing indicates that we could only determine a delta of `r round(five_delta,2)` mm with our current sample size with .9 power. If we wanted to increase the length sensitivity to a delta of 3mm we would need a sample size of `r round(five_size,0)`.  At our current sample size of `r nrow(five)`, we can only detect a 3mm growth delta with `r round(five_power,2)` power.  


#####  Analysis at 1mg Doses

```{r}
one <- subset(ToothGrowth, dose == "1")
model3 <- t.test(len ~ supp, data = one)
model3

one_delta <- power.t.test(n = nrow(one), power = .90, sd = sd(one$len))$delta
one_size <-  power.t.test(delta = 3, power = .90, sd = sd(one$len))$n
one_power <- power.t.test(delta = 3, n = nrow(one), sd = sd(one$len))$power
```
The p value is low at the 1 mg dose level.  Therefore we reject the H0 hypthesis that there is no difference in the means of the supplements and we accept that there is some signifcance to the impact on toothgrowth at this dose level.  

Power testing indicates that we could only determine a delta of `r round(one_delta,2)` mm with our current sample size with .9 power. If we wanted to increase the length sensitivity to a delta of 3mm we would need a sample size of `r round(one_size,0)`.  At our current sample size of `r nrow(one)`, we can only detect a 3mm growth delta with `r round(one_power,2)` power.  


#####  Analysis at 2mg Doses

```{r}
two <- subset(ToothGrowth, dose == "2")
model4 <- t.test(len ~ supp, data = two)
model4
two_delta <- power.t.test(n = nrow(two), power = .90, sd = sd(two$len))$delta
two_size <- power.t.test(delta = 3, power = .90, sd = sd(two$len))$n
two_power <- power.t.test(delta = 3,n = nrow(two), sd = sd(two$len))$power

```
Zero is in the confidence interval and the p value is high. Therefore we can not reject the null hypthesis that the means of the two supplememts are equal at the 2mg dose for tooth growth.

Power testing indicates that we could only determine a delta of `r round(two_delta,2)` mm with our current sample size with .9 power. If we wanted to increase the length sensitivity to a delta of 3mm we would need a sample size of `r round(two_size,0)`.  At our current sample size of `r nrow(two)`, we can only detect a 3mm growth delta with `r round(two_power,2)` power.  


## Conclusion

The exploratory phase of the analysis indicated that there was some possibility of correlation of tooth growth to supplement type and dose.  Both Confidence Intervals and Welch Two Sample hypothesis testing confirmed that there is significance at the .5 mg and 1mg dose levels and no attributable significance to the dose level by supplement type at the 2 mg level.  However, we must careful when we interpret the dosages as the power t.test indicates that diffences in the means is just within the required sample size.  We reccomend that the analysis be conducted with higher sample sizes in the future in order to confirm these findings.
